"use strict";(self.webpackChunkconnections=self.webpackChunkconnections||[]).push([[880],{4880:(ts,de,h)=>{h.r(de),h.d(de,{ConnectionsModule:()=>Wt});var _=h(6814),C=h(5959),Z=h(5237),r=h(4221);const T=(0,r.PH)("[Users] Load Users",(0,r.Ky)()),ge=(0,r.PH)("[Users] Load Users Success",(0,r.Ky)()),he=(0,r.PH)("[Users] Load Users Failed",(0,r.Ky)()),R=(0,r.PH)("[Users] Load Conversations"),me=(0,r.PH)("[Users] Load Conversations Success",(0,r.Ky)()),_e=(0,r.PH)("[Users] Load Conversations Failed",(0,r.Ky)()),H=(0,r.PH)("[Conversation] Create Conversation",(0,r.Ky)()),fe=(0,r.PH)("[Conversation] Create Conversation Success",(0,r.Ky)()),Ce=(0,r.PH)("[Conversation] Create Conversation Failed",(0,r.Ky)()),N=(0,r.PH)("[Conversation] Load Conversation Since",(0,r.Ky)()),ve=(0,r.PH)("[Conversation] Load Conversation Success Since",(0,r.Ky)()),be=(0,r.PH)("[Conversation] Load Conversation Since Failed",(0,r.Ky)()),K=(0,r.PH)("[Conversation] Delete Conversation",(0,r.Ky)()),Se=(0,r.PH)("[Conversation] Delete Conversation Success",(0,r.Ky)()),Le=(0,r.PH)("[Conversation] Delete Conversation Failed",(0,r.Ky)()),Q=(0,r.PH)("[Conversation] Post Message",(0,r.Ky)()),Ae=(0,r.PH)("[Conversation] Post Message Success"),Pe=(0,r.PH)("[Conversation] Post Message Failed",(0,r.Ky)()),J=(0,r.PH)("[Groups] Load Groups"),Ue=(0,r.PH)("[Groups] Load Groups Success",(0,r.Ky)()),Ge=(0,r.PH)("[Groups] Load Groups Failed",(0,r.Ky)()),q=(0,r.PH)("[Groups] Create Group",(0,r.Ky)()),Me=(0,r.PH)("[Groups] Create Group Success",(0,r.Ky)()),ye=(0,r.PH)("[Groups] Create Group Failed",(0,r.Ky)()),V=(0,r.PH)("[Groups] Delete Group",(0,r.Ky)()),De=(0,r.PH)("[Groups] Delete Group Success",(0,r.Ky)()),xe=(0,r.PH)("[Groups] Delete Group Failed",(0,r.Ky)()),w=(0,r.PH)("[Group] Load Group Since",(0,r.Ky)()),ke=(0,r.PH)("[Group] Load Group Since Success",(0,r.Ky)()),j=(0,r.PH)("[Group] Load Group Since Failed",(0,r.Ky)()),B=(0,r.PH)("[Group] Post Message",(0,r.Ky)()),Ve=(0,r.PH)("[Group] Post Message Success"),z=(0,r.PH)("[Group] Post Message Failed",(0,r.Ky)());var e=h(5879),D=h(304),$=h(617);const je=function(){return[""]},ze=function(){return{exact:!0}},Xe=function(){return["profile"]};let We=(()=>{class t{constructor(s,o){this.store=s,this.authService=o}ngOnInit(){this.loadGroups(),this.loadUsers()}loadUsers(){this.store.dispatch(T({currentUserId:this.authService.currentUserID}))}loadGroups(){this.store.dispatch(J())}static#e=this.\u0275fac=function(o){return new(o||t)(e.Y36(r.yh),e.Y36(D.e))};static#t=this.\u0275cmp=e.Xpm({type:t,selectors:[["app-core"]],decls:19,vars:12,consts:[[1,"wrapper"],[1,"sidebar"],[1,"navigation"],["routerLinkActive","active-route",1,"navigation__item",3,"routerLink","routerLinkActiveOptions"],["routerLinkActive","active-route",1,"navigation__item",3,"routerLink"],[1,"main-content"]],template:function(o,n){1&o&&(e.TgZ(0,"div",0)(1,"aside",1)(2,"h1"),e._uU(3,"Connections"),e.qZA(),e.TgZ(4,"nav",2)(5,"a",3)(6,"mat-icon"),e._uU(7,"home"),e.qZA(),e.TgZ(8,"div"),e._uU(9),e.ALo(10,"uppercase"),e.qZA()(),e.TgZ(11,"a",4)(12,"mat-icon"),e._uU(13,"account_circle"),e.qZA(),e.TgZ(14,"div"),e._uU(15),e.ALo(16,"uppercase"),e.qZA()()()(),e.TgZ(17,"section",5),e._UZ(18,"router-outlet"),e.qZA()()),2&o&&(e.xp6(5),e.Q6J("routerLink",e.DdM(9,je))("routerLinkActiveOptions",e.DdM(10,ze)),e.xp6(4),e.Oqu(e.lcZ(10,5,"Home")),e.xp6(2),e.Q6J("routerLink",e.DdM(11,Xe)),e.xp6(4),e.Oqu(e.lcZ(16,7,"Profile")))},dependencies:[C.lC,C.rH,C.Od,$.Hw,_.gd],styles:[".wrapper[_ngcontent-%COMP%]{display:flex;height:100vh}.wrapper[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{color:#d27091}.wrapper[_ngcontent-%COMP%]   .navigation[_ngcontent-%COMP%]{margin-top:20px}.wrapper[_ngcontent-%COMP%]   .navigation__item[_ngcontent-%COMP%]{box-sizing:border-box;display:flex;align-items:center;column-gap:10px;margin-bottom:10px;padding:5px 0}.wrapper[_ngcontent-%COMP%]   .navigation__item[_ngcontent-%COMP%]:hover{color:#d27091}.active-route[_ngcontent-%COMP%]{color:#d27091;border-bottom:2px solid rgb(210,112,145)}.sidebar[_ngcontent-%COMP%]{width:120px;background-color:#444b65;color:#fff;padding:20px}.main-content[_ngcontent-%COMP%]{flex:1;box-sizing:border-box}"]})}return t})();var f=h(6223),G=h(5619),x=h(3371);const X=(0,r.ZF)(x.A.User),et=(0,r.P1)(X,t=>t.isLoading),tt=(0,r.P1)(X,t=>t.userData),W=((0,r.P1)(X,t=>t.userData?.email),(0,r.PH)("[User] Load User")),Oe=(0,r.PH)("[User] Load User Succeshul",(0,r.Ky)()),Fe=(0,r.PH)("[User] Load User Failed",(0,r.Ky)()),ee=(0,r.PH)("[User] Update User Name",(0,r.Ky)()),Ze=(0,r.PH)("[User] Update User Name Successful",(0,r.Ky)()),we=(0,r.PH)("[User] Update User Name Failed",(0,r.Ky)()),te=(0,r.PH)("[User] Logout"),$e=(0,r.PH)("[User] Logout Successful"),Ee=(0,r.PH)("[User] Logout Failed",(0,r.Ky)());let se=(()=>{class t{constructor(s,o){this.fb=s,this.store=o,this.userProfileData$=this.store.pipe((0,r.Ys)(tt)),this.isUserLoading$=this.store.pipe((0,r.Ys)(et)),this.originalFormValues=null,this.isEditMode$=new G.X(!1),this.subscriptions=[],this.userProfileForm=this.fb.group({name:["",[f.kI.required,f.kI.maxLength(40),f.kI.pattern(/^[a-zA-Z\s]+$/)]],email:[""],uid:[""],createdAt:[""]})}enterEditMode(){this.changeEditModeValue(!0),this.originalFormValues={...this.userProfileForm.value}}changeEditModeValue(s){this.isEditMode$.next(s)}subscribeToUserProfileData(){const s=this.userProfileData$.subscribe(o=>{o||this.loadUserData(),o&&this.userProfileForm.setValue(o)});this.subscriptions.push(s)}loadUserData(){this.store.dispatch(W())}logout(){this.store.dispatch(te())}cancelEdit(){this.changeEditModeValue(!1),this.originalFormValues&&this.userProfileForm.setValue(this.originalFormValues)}saveChanges(){this.changeEditModeValue(!1);const s=this.userProfileForm.get("name")?.value;s!==this.originalFormValues?.name&&this.store.dispatch(ee({name:s}))}static#e=this.\u0275fac=function(o){return new(o||t)(e.LFG(f.qu),e.LFG(r.yh))};static#t=this.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac})}return t})();var M=h(2490),oe=h(6941);function ot(t,a){if(1&t){const s=e.EpF();e.TgZ(0,"app-button",7),e.NdJ("buttonClick",function(){e.CHM(s);const n=e.oxw();return e.KtG(n.userService.enterEditMode())}),e.ALo(1,"async"),e.ALo(2,"async"),e._uU(3),e.ALo(4,"uppercase"),e.qZA()}if(2&t){const s=e.oxw();e.Q6J("disabled",e.lcZ(1,2,s.isUserLoading$)||null===e.lcZ(2,4,s.userProfileData$)),e.xp6(3),e.hij(" ",e.lcZ(4,6,"Edit")," ")}}function nt(t,a){if(1&t){const s=e.EpF();e.TgZ(0,"app-button",7),e.NdJ("buttonClick",function(){e.CHM(s);const n=e.oxw();return e.KtG(n.userService.cancelEdit())}),e.ALo(1,"async"),e._uU(2),e.ALo(3,"uppercase"),e.qZA()}if(2&t){const s=e.oxw();e.Q6J("disabled",!!e.lcZ(1,2,s.isUserLoading$)),e.xp6(2),e.hij(" ",e.lcZ(3,4,"Cancel")," ")}}function rt(t,a){if(1&t){const s=e.EpF();e.TgZ(0,"app-button",7),e.NdJ("buttonClick",function(){e.CHM(s);const n=e.oxw();return e.KtG(n.userService.saveChanges())}),e.ALo(1,"async"),e._uU(2),e.ALo(3,"uppercase"),e.qZA()}if(2&t){const s=e.oxw();e.Q6J("disabled",e.lcZ(1,2,s.isUserLoading$)||s.userService.userProfileForm.invalid),e.xp6(2),e.hij(" ",e.lcZ(3,4,"Save")," ")}}let it=(()=>{class t{constructor(s){this.userService=s,this.userProfileData$=this.userService.userProfileData$,this.isUserLoading$=this.userService.isUserLoading$,this.isEditMode$=this.userService.isEditMode$}ngOnInit(){this.userService.subscribeToUserProfileData()}ngOnDestroy(){this.userService.subscriptions.forEach(s=>s.unsubscribe())}static#e=this.\u0275fac=function(o){return new(o||t)(e.Y36(se))};static#t=this.\u0275cmp=e.Xpm({type:t,selectors:[["app-user-form"]],decls:17,vars:32,consts:[[1,"user__form",3,"formGroup"],["className","form-profile","controlName","name","type","text",3,"label","control","readonly"],["className","form-profile","controlName","name","type","email",3,"label","control","readonly"],["className","form-profile","controlName","uid","type","text",3,"label","control","readonly"],["className","form-profile","controlName","createdAt","type","text",3,"label","control","readonly"],[1,"button-container"],[3,"disabled","buttonClick",4,"ngIf"],[3,"disabled","buttonClick"]],template:function(o,n){1&o&&(e.TgZ(0,"form",0),e._UZ(1,"app-form-control",1),e.ALo(2,"uppercase"),e.ALo(3,"async"),e._UZ(4,"app-form-control",2),e.ALo(5,"uppercase"),e._UZ(6,"app-form-control",3),e.ALo(7,"uppercase"),e._UZ(8,"app-form-control",4),e.ALo(9,"uppercase"),e.TgZ(10,"div",5),e.YNc(11,ot,5,8,"app-button",6),e.ALo(12,"async"),e.YNc(13,nt,4,6,"app-button",6),e.ALo(14,"async"),e.YNc(15,rt,4,6,"app-button",6),e.ALo(16,"async"),e.qZA()()),2&o&&(e.Q6J("formGroup",n.userService.userProfileForm),e.xp6(1),e.s9C("label",e.lcZ(2,16,"name:")),e.Q6J("control",n.userService.userProfileForm.get("name"))("readonly",!1===e.lcZ(3,18,n.isEditMode$)),e.xp6(3),e.s9C("label",e.lcZ(5,20,"email:")),e.Q6J("control",n.userService.userProfileForm.get("email"))("readonly",!0),e.xp6(2),e.s9C("label",e.lcZ(7,22,"User ID:")),e.Q6J("control",n.userService.userProfileForm.get("uid"))("readonly",!0),e.xp6(2),e.s9C("label",e.lcZ(9,24,"Created At:")),e.Q6J("control",n.userService.userProfileForm.get("createdAt"))("readonly",!0),e.xp6(3),e.Q6J("ngIf",!1===e.lcZ(12,26,n.isEditMode$)),e.xp6(2),e.Q6J("ngIf",e.lcZ(14,28,n.isEditMode$)),e.xp6(2),e.Q6J("ngIf",e.lcZ(16,30,n.isEditMode$)))},dependencies:[_.O5,f._Y,f.JL,f.sg,oe.A,M.r,_.Ov,_.gd],styles:[".user__form[_ngcontent-%COMP%]{width:100%;margin-bottom:20px}.user__form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%}.button-container[_ngcontent-%COMP%]{margin-top:10px;display:flex;column-gap:20px;justify-content:flex-end}.icon[_ngcontent-%COMP%]{display:block!important}"],changeDetection:0})}return t})(),at=(()=>{class t{constructor(s){this.userService=s,this.isUserLoading$=this.userService.isUserLoading$}static#e=this.\u0275fac=function(o){return new(o||t)(e.Y36(se))};static#t=this.\u0275cmp=e.Xpm({type:t,selectors:[["app-user-page"]],decls:13,vars:4,consts:[[1,"content"],[1,"container","user"],[1,"user__header"],[1,"header__title"],[1,"icon"],["customClass","exit__btn","title","Logout",3,"disabled","buttonClick"]],template:function(o,n){if(1&o&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"mat-icon",4),e._uU(5,"account_circle"),e.qZA(),e.TgZ(6,"h2"),e._uU(7),e.qZA()(),e.TgZ(8,"app-button",5),e.NdJ("buttonClick",function(){return n.userService.logout()}),e.ALo(9,"async"),e.TgZ(10,"mat-icon"),e._uU(11,"exit_to_app"),e.qZA()()(),e._UZ(12,"app-user-form"),e.qZA()()),2&o){let i;e.xp6(7),e.Oqu(null==(i=n.userService.userProfileForm.get("name"))?null:i.getRawValue()),e.xp6(1),e.Q6J("disabled",!!e.lcZ(9,2,n.isUserLoading$))}},dependencies:[M.r,$.Hw,it,_.Ov],styles:[".content[_ngcontent-%COMP%]{height:100vh;display:flex;justify-content:center;align-items:center;gap:20px;flex-direction:column}.user[_ngcontent-%COMP%]{min-width:500px;height:50%;background-color:#444b65;padding:20px;border-radius:8px;display:flex;flex-direction:column;justify-content:space-evenly}.user[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#d27091}.user__header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.header__title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;color:#d27091}.icon[_ngcontent-%COMP%]{display:block!important}"],changeDetection:0})}return t})();var ct=h(9080);let P=(()=>{class t{constructor(){this.countdowns=new Map,this.timerSubscriptions=new Map}setCountdown(s,o){this.countdowns.has(s)||this.countdowns.set(s,new G.X(0)),this.countdowns.get(s)?.next(o)}getCountdownValue(s){const o=this.countdowns.get(s);return o?o.getValue():0}handleCountdown(s,o){this.countdowns.has(s)||this.countdowns.set(s,new G.X(0)),this.timerSubscriptions.has(s)&&this.timerSubscriptions.get(s)?.unsubscribe(),this.setCountdown(s,o),this.timerSubscriptions.set(s,(0,ct.H)(0,1e3).subscribe(()=>{const n=this.getCountdownValue(s);n>0?this.setCountdown(s,n-1):this.timerSubscriptions.get(s)?.unsubscribe()}))}isCountdownEnded(s){return!(this.getCountdownValue(s)>0)}stopAllCountdowns(){this.timerSubscriptions.forEach((s,o)=>{s.unsubscribe(),this.countdowns.get(o)?.next(0)}),this.timerSubscriptions.clear()}static#e=this.\u0275fac=function(o){return new(o||t)};static#t=this.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var y=h(7700);let ut=(()=>{class t{constructor(s,o){this.data=s,this.dialogRef=o}closeDialog(){this.dialogRef.close(!1)}static#e=this.\u0275fac=function(o){return new(o||t)(e.Y36(y.WI),e.Y36(y.so))};static#t=this.\u0275cmp=e.Xpm({type:t,selectors:[["app-dialog"]],decls:8,vars:3,consts:[[1,"content-container"],[1,"content-span","full-width"],["id","no-button",3,"mat-dialog-close"],["id","yes-button",3,"mat-dialog-close"]],template:function(o,n){1&o&&(e.TgZ(0,"div")(1,"div",0)(2,"span",1),e._uU(3),e.qZA()(),e.TgZ(4,"button",2),e._uU(5,"CANCEL"),e.qZA(),e.TgZ(6,"button",3),e._uU(7,"DELETE"),e.qZA()()),2&o&&(e.xp6(3),e.Oqu(n.data.message),e.xp6(1),e.Q6J("mat-dialog-close",!1),e.xp6(2),e.Q6J("mat-dialog-close",!0))},dependencies:[y.ZT],changeDetection:0})}return t})(),ne=(()=>{class t{constructor(s){this.dialog=s}openConfirmDialog(s){return this.dialog.open(ut,{width:"350px",panelClass:"confirm-dialog-container",position:{top:"10px"},data:{message:s}})}onDialogClose(){this.dialog.closeAll()}static#e=this.\u0275fac=function(o){return new(o||t)(e.LFG(y.uw))};static#t=this.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var E=h(8180);const I=(0,r.ZF)(x.A.Groups),Ie=(0,r.P1)(I,t=>t.isLoading),Te=(0,r.P1)(I,t=>t.groups),Ne=((0,r.P1)(Te,t=>t?.items.map(a=>a.uid)),(0,r.P1)(I,t=>t.backendErrors));(0,r.P1)(I,t=>t.loadedGroupIds);var k=h(553),re=h(9862);let ie=(()=>{class t{constructor(s){this.http=s,this.isCreateGroupModalClosed=new G.X(!1),this.GROUPS_API_URL=`${k.N.apiUrl}groups/`,this.GROUPS_LIST_ENDPOINT="list",this.GROUPS_CREATE_ENDPOINT="create",this.GROUPS_DELETE_ENDPOINT="delete",this.GROUPS_READ_ENDPOINT="read",this.GROUPS_APPEND_ENDPOINT="append"}loadGroups(){return this.http.get(`${this.GROUPS_API_URL}${this.GROUPS_LIST_ENDPOINT}`)}createGroup(s){return this.http.post(`${this.GROUPS_API_URL}${this.GROUPS_CREATE_ENDPOINT}`,{name:s})}deleteGroup(s){const o=`${this.GROUPS_API_URL}${this.GROUPS_DELETE_ENDPOINT}?groupID=${s.trim()}`;return this.http.delete(o)}loadAllMesages(s,o){return this.http.get(`${this.GROUPS_API_URL}${this.GROUPS_READ_ENDPOINT}?groupID=${s}${o?`&since=${o}`:""}`)}postNewMessage(s,o){return this.http.post(`${this.GROUPS_API_URL}${this.GROUPS_APPEND_ENDPOINT}`,{groupID:s,message:o})}static#e=this.\u0275fac=function(o){return new(o||t)(e.LFG(re.eN))};static#t=this.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac})}return t})(),O=(()=>{class t{constructor(s,o,n,i,u,p,c,d){this.store=s,this.fb=o,this.dialog=n,this.dialogService=i,this.authService=u,this.groupApiService=p,this.countdownService=c,this.router=d,this.groupsData$=this.store.pipe((0,r.Ys)(Te)),this.isGroupsLoading$=this.store.pipe((0,r.Ys)(Ie)),this.backendGroupsErrors$=this.store.pipe((0,r.Ys)(Ne)),this.subscriptions=[],this.currentUserID=this.authService.currentUserID,this.groupCreateForm=this.fb.group({name:["",[f.kI.required,f.kI.maxLength(30),f.kI.pattern(/^[a-zA-Z0-9\s\u0400-\u04FF]+$/)]]}),this.isGroupJustCreated$=new G.X(!1)}loadGroups(){this.store.dispatch(J())}toConversationGroupPage(s){s&&this.router.navigate([`group/${s}`])}isGroupCreatedByCurrentUser(s){return this.currentUserID===s}onCreateFormSubmit(){const s=this.groupCreateForm.get("name")?.value||"";this.store.dispatch(q({name:s,userId:this.authService.currentUserID}));const n=this.groupApiService.isCreateGroupModalClosed.subscribe(i=>{!0===i&&this.dialogService.onDialogClose()});this.subscriptions.push(n)}updateGroupsList(){this.loadGroups();const s=this.isGroupsLoading$.subscribe(o=>{o||this.backendGroupsErrors$.subscribe(n=>{n||this.countdownService.handleCountdown("groups",60)})});this.subscriptions.push(s)}onCreateGroup(s){this.groupCreateForm.reset();const o=new y.vA;o.width="40%",this.dialog.open(s,o)}onDeleteGroup(s,o=!1){const n=s??"";this.dialogService.openConfirmDialog("Are you sure you want to delete this group?").afterClosed().pipe((0,E.q)(1)).subscribe(i=>{i&&this.store.dispatch(V({groupID:n,redirect:o}))})}static#e=this.\u0275fac=function(o){return new(o||t)(e.LFG(r.yh),e.LFG(f.qu),e.LFG(y.uw),e.LFG(ne),e.LFG(D.e),e.LFG(ie),e.LFG(P),e.LFG(C.F0))};static#t=this.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac})}return t})();const U=(0,r.ZF)(x.A.Users),Je=(0,r.P1)(U,t=>t.isUsersLoading),lt=(0,r.P1)(U,t=>t.isAllConversationsLoading),dt=(0,r.P1)(U,t=>t.isConversationLoading),gt=(0,r.P1)(U,t=>t.users),ht=(0,r.P1)(U,t=>t.backendUsersErrors),mt=(0,r.P1)(U,t=>t.backendConverstionsErrors);(0,r.P1)(U,t=>t.loadedConversatonsIds);let F=(()=>{class t{constructor(s,o,n,i,u,p){this.store=s,this.router=o,this.dialogRef=n,this.dialogService=i,this.authService=u,this.countdownService=p,this.usersData$=this.store.pipe((0,r.Ys)(gt)),this.isUsersLoading$=this.store.pipe((0,r.Ys)(Je)),this.backendUsersListErrors$=this.store.pipe((0,r.Ys)(ht)),this.isConversationJustCreated$=new G.X(!1),this.subscriptions=[]}toConversationPage(s,o=""){o?this.router.navigate([`conversation/${o}`]):(this.store.dispatch(H({companion:s??""})),this.isConversationJustCreated$.next(!0))}onDeleteConversation(s){this.dialogService.openConfirmDialog("Are you sure you want to delete this conversation?").afterClosed().subscribe(o=>{o&&this.store.dispatch(K({conversationID:s,redirect:!0}))})}loadUsers(){this.store.dispatch(T({currentUserId:this.authService.currentUserID}))}updateUsersList(){this.loadUsers();const s=this.isUsersLoading$.subscribe(o=>{o||this.backendUsersListErrors$.subscribe(n=>{n||this.countdownService.handleCountdown("users",60)})});this.subscriptions.push(s)}isConversationID(s){return!!s&&!!s.conversatonID}static#e=this.\u0275fac=function(o){return new(o||t)(e.LFG(r.yh),e.LFG(C.F0),e.LFG(y.so),e.LFG(ne),e.LFG(D.e),e.LFG(P))};static#t=this.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac})}return t})();function ft(t,a){if(1&t&&(e.TgZ(0,"div"),e._uU(1),e.qZA()),2&t){const s=e.oxw();e.xp6(1),e.hij(" ","Please wait "+s.countdownService.getCountdownValue(s.identifier)+" seconds, until the update button becomes enabled","\n")}}let ae=(()=>{class t{constructor(s){this.countdownService=s,this.identifier=""}static#e=this.\u0275fac=function(o){return new(o||t)(e.Y36(P))};static#t=this.\u0275cmp=e.Xpm({type:t,selectors:[["app-countdown-message"]],inputs:{identifier:"identifier"},decls:1,vars:1,consts:[[4,"ngIf"]],template:function(o,n){1&o&&e.YNc(0,ft,2,1,"div",0),2&o&&e.Q6J("ngIf",!n.countdownService.isCountdownEnded(n.identifier))},dependencies:[_.O5]})}return t})();var Ct=h(5940);function vt(t,a){1&t&&(e.TgZ(0,"div",1),e._UZ(1,"mat-progress-spinner",2),e.qZA())}let ce=(()=>{class t{constructor(){this.isLoading=!1}static#e=this.\u0275fac=function(o){return new(o||t)};static#t=this.\u0275cmp=e.Xpm({type:t,selectors:[["app-loader"]],inputs:{isLoading:"isLoading"},decls:1,vars:1,consts:[["class","loader",4,"ngIf"],[1,"loader"],["mode","indeterminate","diameter","60",1,"loader"]],template:function(o,n){1&o&&e.YNc(0,vt,2,0,"div",0),2&o&&e.Q6J("ngIf",n.isLoading)},dependencies:[_.O5,Ct.Ou],styles:[".loader[_ngcontent-%COMP%]{text-align:center;margin:10px auto}"],changeDetection:0})}return t})();function bt(t,a){1&t&&(e.TgZ(0,"span"),e._uU(1," *****"),e.qZA())}function St(t,a){if(1&t){const s=e.EpF();e.TgZ(0,"app-button",4),e.NdJ("buttonClick",function(){e.CHM(s);const n=e.oxw();return e.KtG(n.onDeleteGroup(n.group.uid))}),e._uU(1," \u2715 "),e.qZA()}}let Lt=(()=>{class t{constructor(){this.isGroupComponent=!1,this.deleteGroup=new e.vpe,this.openConversation=new e.vpe}onDeleteGroup(s){this.deleteGroup.emit(s)}onGroupClick(s,o=""){this.openConversation.emit({groupId:s,companionId:o})}static#e=this.\u0275fac=function(o){return new(o||t)};static#t=this.\u0275cmp=e.Xpm({type:t,selectors:[["app-element-details"]],inputs:{group:"group",isActive:"isActive",isGroupComponent:"isGroupComponent"},outputs:{deleteGroup:"deleteGroup",openConversation:"openConversation"},decls:5,vars:5,consts:[[1,"item"],[1,"group-property",3,"click"],[4,"ngIf"],["customClass","delete__btn","title","Delete",3,"buttonClick",4,"ngIf"],["customClass","delete__btn","title","Delete",3,"buttonClick"]],template:function(o,n){1&o&&(e.TgZ(0,"div",0)(1,"div",1),e.NdJ("click",function(){return n.onGroupClick(n.group.uid,null==n.group?null:n.group.conversatonID)}),e._uU(2),e.YNc(3,bt,2,0,"span",2),e.qZA(),e.YNc(4,St,2,0,"app-button",3),e.qZA()),2&o&&(e.ekj("active",n.isActive),e.xp6(2),e.hij(" ",null==n.group?null:n.group.name," "),e.xp6(1),e.Q6J("ngIf",n.isActive&&!n.isGroupComponent),e.xp6(1),e.Q6J("ngIf",n.isActive&&n.isGroupComponent))},dependencies:[M.r,_.O5],styles:[".item[_ngcontent-%COMP%]{cursor:pointer;display:flex;justify-content:space-between;border:1px solid rgb(210,112,145);border-radius:8px;margin-bottom:10px;height:40px;align-items:center;padding:0 10px}.item[_ngcontent-%COMP%]:hover{background-color:#444b65}.group-property[_ngcontent-%COMP%]{flex:1;height:100%;display:flex;align-items:center}.active[_ngcontent-%COMP%]{background-color:#34394e}"]})}return t})();function At(t,a){if(1&t){const s=e.EpF();e.ynx(0),e.TgZ(1,"app-element-details",5),e.NdJ("openConversation",function(n){e.CHM(s);const i=e.oxw(2);return e.KtG(i.groupsService.toConversationGroupPage(n.groupId))})("deleteGroup",function(){const i=e.CHM(s).$implicit,u=e.oxw(2);return e.KtG(u.groupsService.onDeleteGroup(i.uid))}),e.qZA(),e.BQk()}if(2&t){const s=a.$implicit,o=e.oxw(2);e.xp6(1),e.Q6J("group",s)("isGroupComponent",o.isGroupComponent)("isActive",o.groupsService.isGroupCreatedByCurrentUser(null==s?null:s.createdBy))}}function Pt(t,a){if(1&t&&(e.TgZ(0,"div",3),e.YNc(1,At,2,3,"ng-container",4),e.qZA()),2&t){const s=e.oxw();e.xp6(1),e.Q6J("ngForOf",s.groups)}}function Ut(t,a){if(1&t){const s=e.EpF();e.ynx(0),e.TgZ(1,"app-element-details",6),e.NdJ("openConversation",function(n){e.CHM(s);const i=e.oxw(2);return e.KtG(i.usersService.toConversationPage(n.groupId,n.companionId))}),e.qZA(),e.BQk()}if(2&t){const s=a.$implicit,o=e.oxw(2);e.xp6(1),e.Q6J("group",s)("isActive",o.usersService.isConversationID(s))}}function Gt(t,a){if(1&t&&(e.TgZ(0,"div",3),e.YNc(1,Ut,2,2,"ng-container",4),e.qZA()),2&t){const s=e.oxw();e.xp6(1),e.Q6J("ngForOf",s.groups)}}let Mt=(()=>{class t{constructor(s,o){this.groupsService=s,this.usersService=o,this.isGroupComponent=!1}static#e=this.\u0275fac=function(o){return new(o||t)(e.Y36(O),e.Y36(F))};static#t=this.\u0275cmp=e.Xpm({type:t,selectors:[["app-elements-list"]],inputs:{groups:"groups",isGroupLoading:"isGroupLoading",isGroupComponent:"isGroupComponent"},decls:4,vars:3,consts:[[3,"isLoading"],["class","content__items",4,"ngIf","ngIfElse"],["usersList",""],[1,"content__items"],[4,"ngFor","ngForOf"],[3,"group","isGroupComponent","isActive","openConversation","deleteGroup"],[3,"group","isActive","openConversation"]],template:function(o,n){if(1&o&&(e._UZ(0,"app-loader",0),e.YNc(1,Pt,2,1,"div",1),e.YNc(2,Gt,2,1,"ng-template",null,2,e.W1O)),2&o){const i=e.MAs(3);e.Q6J("isLoading",n.isGroupLoading),e.xp6(1),e.Q6J("ngIf",n.isGroupComponent)("ngIfElse",i)}},dependencies:[ce,_.sg,_.O5,Lt],styles:[".content__items[_ngcontent-%COMP%]{max-height:410px;height:100%;overflow:auto;contain:strict;padding-right:10px}.content__items[_ngcontent-%COMP%]::-webkit-scrollbar{width:7px;height:7px;background-color:#444b65}.content__items[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:#d27091;border-radius:10px}"]})}return t})();function yt(t,a){if(1&t){const s=e.EpF();e.TgZ(0,"div",10)(1,"form",11),e.NdJ("ngSubmit",function(){e.CHM(s);const n=e.oxw();return e.KtG(n.groupsService.onCreateFormSubmit())}),e._UZ(2,"app-form-control",12),e.ALo(3,"uppercase"),e.TgZ(4,"app-button",13),e.ALo(5,"async"),e._uU(6),e.ALo(7,"uppercase"),e.qZA()(),e.TgZ(8,"app-button",14),e.NdJ("buttonClick",function(){e.CHM(s);const n=e.oxw();return e.KtG(n.dialogService.onDialogClose())}),e._uU(9," \u2715 "),e.qZA()()}if(2&t){const s=e.oxw();e.xp6(1),e.Q6J("formGroup",s.groupsService.groupCreateForm),e.xp6(1),e.s9C("label",e.lcZ(3,6,"name:")),e.Q6J("control",s.groupsService.groupCreateForm.get("name"))("readonly",!1),e.xp6(2),e.Q6J("disabled",e.lcZ(5,8,s.isGroupsLoading$)||s.groupsService.groupCreateForm.invalid),e.xp6(2),e.hij(" ",e.lcZ(7,10,"Create Group")," ")}}let Dt=(()=>{class t{constructor(s,o,n,i){this.countdownService=s,this.dialogService=o,this.groupsService=n,this.usersService=i,this.groupsData$=this.groupsService.groupsData$,this.isGroupsLoading$=this.groupsService.isGroupsLoading$,this.usersData$=this.usersService.usersData$,this.isUsersLoading$=this.usersService.isUsersLoading$}ngOnDestroy(){this.groupsService.subscriptions.forEach(s=>s.unsubscribe())}static#e=this.\u0275fac=function(o){return new(o||t)(e.Y36(P),e.Y36(ne),e.Y36(O),e.Y36(F))};static#t=this.\u0275cmp=e.Xpm({type:t,selectors:[["app-main"]],decls:32,vars:28,consts:[[1,"main__container"],[1,"main__content"],[1,"content__header"],[1,"btns__container"],[3,"disabled","buttonClick"],["customClass","create__btn","title","Create group",3,"disabled","buttonClick"],[3,"identifier"],[3,"groups","isGroupLoading","isGroupComponent"],[3,"groups","isGroupLoading"],["createForm",""],[1,"create-form"],[3,"formGroup","ngSubmit"],["controlName","name","type","text",3,"label","control","readonly"],["type","submit",3,"disabled"],["customClass","close-dialog__btn","title","Close",3,"buttonClick"]],template:function(o,n){if(1&o){const i=e.EpF();e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2"),e._uU(4,"GROUPS"),e.qZA(),e.TgZ(5,"div",3)(6,"app-button",4),e.NdJ("buttonClick",function(){return n.groupsService.updateGroupsList()}),e._uU(7),e.ALo(8,"uppercase"),e.qZA(),e.TgZ(9,"app-button",5),e.NdJ("buttonClick",function(){e.CHM(i);const p=e.MAs(31);return e.KtG(n.groupsService.onCreateGroup(p))}),e.ALo(10,"async"),e.ALo(11,"async"),e.TgZ(12,"mat-icon"),e._uU(13,"add"),e.qZA()()(),e._UZ(14,"app-countdown-message",6),e.qZA(),e._UZ(15,"app-elements-list",7),e.ALo(16,"async"),e.ALo(17,"async"),e.qZA(),e.TgZ(18,"div",1)(19,"div",2)(20,"h2"),e._uU(21,"PEOPLE"),e.qZA(),e.TgZ(22,"div",3)(23,"app-button",4),e.NdJ("buttonClick",function(){return n.usersService.updateUsersList()}),e._uU(24),e.ALo(25,"uppercase"),e.qZA()(),e._UZ(26,"app-countdown-message",6),e.qZA(),e._UZ(27,"app-elements-list",8),e.ALo(28,"async"),e.ALo(29,"async"),e.qZA()(),e.YNc(30,yt,10,12,"ng-template",null,9,e.W1O)}if(2&o){let i,u;e.xp6(6),e.Q6J("disabled",!n.countdownService.isCountdownEnded("groups")),e.xp6(1),e.hij(" ",e.lcZ(8,12,"Update List")," "),e.xp6(2),e.Q6J("disabled",e.lcZ(10,14,n.isGroupsLoading$)||null===e.lcZ(11,16,n.groupsData$)),e.xp6(5),e.Q6J("identifier","groups"),e.xp6(1),e.Q6J("groups",null==(i=e.lcZ(16,18,n.groupsData$))?null:i.items)("isGroupLoading",e.lcZ(17,20,n.isGroupsLoading$))("isGroupComponent",!0),e.xp6(8),e.Q6J("disabled",!n.countdownService.isCountdownEnded("users")),e.xp6(1),e.hij(" ",e.lcZ(25,22,"Update List")," "),e.xp6(2),e.Q6J("identifier","users"),e.xp6(1),e.Q6J("groups",null==(u=e.lcZ(28,24,n.usersData$))?null:u.items)("isGroupLoading",e.lcZ(29,26,n.isUsersLoading$))}},dependencies:[$.Hw,f._Y,f.JL,f.sg,oe.A,ae,M.r,Mt,_.Ov,_.gd],styles:[".main__container[_ngcontent-%COMP%]{display:flex;height:100%}.main__content[_ngcontent-%COMP%]{padding:20px;border:1px solid rgb(210,112,145);flex:1}h2[_ngcontent-%COMP%]{color:#d27091}.content__header[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:20px;flex-direction:column;margin-bottom:20px}.btns__container[_ngcontent-%COMP%]{display:flex;gap:20px;flex-wrap:wrap}.create-form[_ngcontent-%COMP%]{padding:30px;position:relative}"]})}return t})(),Be=(()=>{class t{constructor(s,o,n,i){this.store=s,this.authService=o,this.countdownService=n,this.groupsservice=i,this.isGroupDialogLoading$=this.store.pipe((0,r.Ys)(Ie)),this.backendErrors$=this.store.pipe((0,r.Ys)(Ne)),this.isGroupCreatedByCurrnetUser$=new G.X(!1),this.subscriptions=[]}updateGroupDialog(s,o){this.loadMessagesSince(s,o);const n=this.isGroupDialogLoading$.subscribe(i=>{i||this.backendErrors$.subscribe(u=>{u||this.countdownService.handleCountdown("groupDailog"+s,60)})});this.subscriptions.push(n)}loadMessagesSince(s,o){o.pipe((0,E.q)(1)).subscribe(n=>{this.store.dispatch(w({groupID:s,time:n?.lastUpdated||0}))})}subscribeToGroupDialogData(s,o){const n=o.pipe((0,E.q)(1)).subscribe(i=>{(!i||!1===this.groupsservice.isGroupJustCreated$.value)&&this.loadMessagesSince(s,o),i&&i.createdBy===this.authService.currentUserID&&this.isGroupCreatedByCurrnetUser$.next(!0)});this.subscriptions.push(n)}static#e=this.\u0275fac=function(o){return new(o||t)(e.LFG(r.yh),e.LFG(D.e),e.LFG(P),e.LFG(O))};static#t=this.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac})}return t})(),Y=(()=>{class t{constructor(s,o,n){this.fb=s,this.store=o,this.authService=n,this.createMessageForm=this.fb.group({text:["",[f.kI.required]]})}isMessageCreatedByCurrentUser(s){return s===this.authService.currentUserID}messageDateComparator(s,o){return+s.createdAt-+o.createdAt}resetMessageForm(){this.createMessageForm.reset()}sendMessageCommon(s,o,n){const i=this.createMessageForm.get("text")?.value||"";o.pipe((0,E.q)(1)).subscribe(u=>{u&&this.store.dispatch(n({targetID:s,message:i,time:u.lastUpdated||0}))}),this.resetMessageForm()}sendMessageForConversation(s,o){this.sendMessageCommon(s,o,n=>Q({conversationID:n.targetID,message:n.message,time:n.time}))}sendMessageForGroup(s,o){this.sendMessageCommon(s,o,n=>B({groupID:n.targetID,message:n.message,time:n.time}))}static#e=this.\u0275fac=function(o){return new(o||t)(e.LFG(f.qu),e.LFG(r.yh),e.LFG(D.e))};static#t=this.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac})}return t})(),xt=(()=>{class t{transform(s,o){return s?s.slice().sort(o):null}static#e=this.\u0275fac=function(o){return new(o||t)};static#t=this.\u0275pipe=e.Yjl({name:"sortBy",type:t,pure:!0})}return t})(),kt=(()=>{class t{transform(s,o){if(!o)return"Unknown User";const n=o.items.find(i=>i.uid===s);return n?n.name:"Me"}static#e=this.\u0275fac=function(o){return new(o||t)};static#t=this.\u0275pipe=e.Yjl({name:"userNameTransform",type:t,pure:!0})}return t})();function Ot(t,a){if(1&t&&(e.TgZ(0,"div",2)(1,"div",3),e._uU(2),e.ALo(3,"userNameTransform"),e.ALo(4,"async"),e.qZA(),e.TgZ(5,"div",4),e._uU(6),e.qZA(),e.TgZ(7,"div",5),e._uU(8),e.ALo(9,"date"),e.qZA()()),2&t){const s=a.$implicit,o=e.oxw();e.ekj("currentUser",o.messagesService.isMessageCreatedByCurrentUser(s.authorID)),e.xp6(2),e.hij(" ",e.xi3(3,5,s.authorID,e.lcZ(4,8,o.usersData$))," "),e.xp6(4),e.Oqu(s.message),e.xp6(2),e.hij(" ",e.xi3(9,10,s.createdAt,"short")," ")}}let Ye=(()=>{class t{constructor(s,o){this.usersService=s,this.messagesService=o,this.usersData$=this.usersService.usersData$}static#e=this.\u0275fac=function(o){return new(o||t)(e.Y36(F),e.Y36(Y))};static#t=this.\u0275cmp=e.Xpm({type:t,selectors:[["app-messages-list"]],inputs:{messages:"messages"},decls:3,vars:4,consts:[[1,"messages"],["class","message",3,"currentUser",4,"ngFor","ngForOf"],[1,"message"],[1,"message__creator"],[1,"message__text"],[1,"message__date"]],template:function(o,n){1&o&&(e.TgZ(0,"div",0),e.YNc(1,Ot,10,13,"div",1),e.ALo(2,"sortBy"),e.qZA()),2&o&&(e.xp6(1),e.Q6J("ngForOf",e.xi3(2,1,null==n.messages?null:n.messages.items,n.messagesService.messageDateComparator)))},dependencies:[_.sg,xt,_.Ov,_.uU,kt],styles:[".messages[_ngcontent-%COMP%]{padding:20px;display:flex;flex-direction:column;max-height:370px;height:100%;overflow:auto;margin-bottom:100px}.message[_ngcontent-%COMP%]{display:block;border-radius:8px;padding:10px;margin-bottom:10px;width:-moz-fit-content;width:fit-content;display:flex;flex-direction:column;min-width:200px;max-width:50%;background-color:#444b65;align-self:flex-start}.message__text[_ngcontent-%COMP%]{word-wrap:break-word}.messages[_ngcontent-%COMP%]::-webkit-scrollbar{width:7px;height:7px;background-color:#444b65}.messages[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:#d27091;border-radius:10px}.message__creator[_ngcontent-%COMP%]{align-self:flex-end}.message__date[_ngcontent-%COMP%]{font-size:12px;color:#c7c7c7;align-self:flex-end}.currentUser[_ngcontent-%COMP%]{background-color:#d27091;align-self:flex-end!important}"],changeDetection:0})}return t})(),Re=(()=>{class t{constructor(){this.sendMessage=new e.vpe}onSendMessage(){this.sendMessage.emit()}static#e=this.\u0275fac=function(o){return new(o||t)};static#t=this.\u0275cmp=e.Xpm({type:t,selectors:[["app-post-message-form"]],inputs:{formGroup:"formGroup",isLoading$:"isLoading$"},outputs:{sendMessage:"sendMessage"},decls:9,vars:12,consts:[[1,"create__message"],[1,"message__form",3,"formGroup"],[1,"message__input"],["className","message-form","controlName","text","type","text",3,"label","control","readonly"],["customClass","post__btn",3,"disabled","buttonClick"]],template:function(o,n){1&o&&(e.TgZ(0,"div",0)(1,"form",1)(2,"div",2),e._UZ(3,"app-form-control",3),e.ALo(4,"uppercase"),e.qZA(),e.TgZ(5,"app-button",4),e.NdJ("buttonClick",function(){return n.onSendMessage()}),e.ALo(6,"async"),e._uU(7),e.ALo(8,"uppercase"),e.qZA()()()),2&o&&(e.xp6(1),e.Q6J("formGroup",n.formGroup),e.xp6(2),e.s9C("label",e.lcZ(4,6,"")),e.Q6J("control",n.formGroup.get("text"))("readonly",!1),e.xp6(2),e.Q6J("disabled",e.lcZ(6,8,n.isLoading$)||n.formGroup.invalid),e.xp6(2),e.hij(" ",e.lcZ(8,10,"send")," "))},dependencies:[f._Y,f.JL,f.sg,oe.A,M.r,_.Ov,_.gd],styles:[".message__input[_ngcontent-%COMP%]{flex:1}.message__form[_ngcontent-%COMP%]{display:flex;padding:20px;gap:30px;justify-content:space-between}.create__message[_ngcontent-%COMP%]{position:absolute;bottom:0;min-height:50px;background-color:#31374b;width:100%;border-radius:0 0 8px 8px}"],changeDetection:0})}return t})();function Ft(t,a){if(1&t){const s=e.EpF();e.TgZ(0,"app-button",13),e.NdJ("buttonClick",function(){e.CHM(s);const n=e.oxw();return e.KtG(n.groupsService.onDeleteGroup(n.groupID,!0))}),e.ALo(1,"async"),e.TgZ(2,"mat-icon"),e._uU(3,"delete"),e.qZA()()}if(2&t){const s=e.oxw();e.Q6J("disabled",!!e.lcZ(1,1,s.isGroupDialogLoading$))}}let Zt=(()=>{class t{constructor(s,o,n,i,u,p){this.store=s,this.countdownService=o,this.groupsService=n,this.groupPageService=i,this.route=u,this.messagesService=p,this.isGroupDialogLoading$=this.groupPageService.isGroupDialogLoading$,this.backendErrors$=this.groupPageService.backendErrors$,this.isGroupCreatedByCurrnetUser$=this.groupPageService.isGroupCreatedByCurrnetUser$,this.groupID=""}initGroupPageValues(){this.groupID=this.route.snapshot.paramMap.get("id"),this.groupDialogData$=this.store.pipe((0,r.Ys)((t=>(0,r.P1)(I,a=>a.groups&&a.groups.items&&a.groups.items.find(s=>s.uid===t)||null))(this.groupID)))}ngOnInit(){this.initGroupPageValues(),this.groupPageService.subscribeToGroupDialogData(this.groupID,this.groupDialogData$)}ngOnDestroy(){this.groupPageService.subscriptions.forEach(s=>s.unsubscribe())}static#e=this.\u0275fac=function(o){return new(o||t)(e.Y36(r.yh),e.Y36(P),e.Y36(O),e.Y36(Be),e.Y36(C.gz),e.Y36(Y))};static#t=this.\u0275cmp=e.Xpm({type:t,selectors:[["app-group-page"]],decls:25,vars:23,consts:[[1,"group-dialog"],[1,"group-dialog__header"],[1,"content"],[1,"header__title"],["routerLink","/","title","Go to main page",1,"header__control"],[1,"header__controls"],[3,"disabled","buttonClick"],["title","Delete group","customClass","header__control header__control-delete",3,"disabled","buttonClick",4,"ngIf"],[3,"identifier"],[3,"isLoading"],[1,"group-dialog__main"],[3,"messages"],[3,"formGroup","isLoading$","sendMessage"],["title","Delete group","customClass","header__control header__control-delete",3,"disabled","buttonClick"]],template:function(o,n){if(1&o&&(e.TgZ(0,"section",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"a",4)(5,"mat-icon"),e._uU(6,"keyboard_arrow_left"),e.qZA()(),e.TgZ(7,"h2"),e._uU(8),e.ALo(9,"uppercase"),e.ALo(10,"async"),e.qZA()(),e.TgZ(11,"div",5)(12,"app-button",6),e.NdJ("buttonClick",function(){return n.groupPageService.updateGroupDialog(n.groupID,n.groupDialogData$)}),e.ALo(13,"async"),e._uU(14),e.ALo(15,"uppercase"),e.qZA(),e.YNc(16,Ft,4,3,"app-button",7),e.ALo(17,"async"),e.qZA()(),e._UZ(18,"app-countdown-message",8),e.qZA(),e._UZ(19,"app-loader",9),e.ALo(20,"async"),e.TgZ(21,"div",10),e._UZ(22,"app-messages-list",11),e.ALo(23,"async"),e.TgZ(24,"app-post-message-form",12),e.NdJ("sendMessage",function(){return n.messagesService.sendMessageForGroup(n.groupID,n.groupDialogData$)}),e.qZA()()()),2&o){let i,u;e.xp6(8),e.hij(" ",e.lcZ(9,9,'Group "'+((null==(i=e.lcZ(10,11,n.groupDialogData$))?null:i.name)||"")+'"')," "),e.xp6(4),e.Q6J("disabled",!n.countdownService.isCountdownEnded("groupDailog"+n.groupID)||!!e.lcZ(13,13,n.isGroupDialogLoading$)),e.xp6(2),e.hij(" ",e.lcZ(15,15,"Update messages")," "),e.xp6(2),e.Q6J("ngIf",e.lcZ(17,17,n.isGroupCreatedByCurrnetUser$)),e.xp6(2),e.Q6J("identifier","groupDailog"+n.groupID),e.xp6(1),e.Q6J("isLoading",e.lcZ(20,19,n.isGroupDialogLoading$)),e.xp6(3),e.Q6J("messages",null==(u=e.lcZ(23,21,n.groupDialogData$))?null:u.messages),e.xp6(2),e.Q6J("formGroup",n.messagesService.createMessageForm)("isLoading$",n.isGroupDialogLoading$)}},dependencies:[$.Hw,f.JL,f.sg,ce,ae,M.r,C.rH,_.O5,Ye,Re,_.Ov,_.gd],styles:[".group-dialog[_ngcontent-%COMP%]{padding:10px;max-width:800px;margin:0 auto}.group-dialog[_ngcontent-%COMP%]   .group-dialog__header[_ngcontent-%COMP%]{padding:10px;border-radius:8px;border:1px solid rgb(210,112,145);color:#d27091}.group-dialog[_ngcontent-%COMP%]   .group-dialog__header[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between}.group-dialog[_ngcontent-%COMP%]   .header__title[_ngcontent-%COMP%], .group-dialog[_ngcontent-%COMP%]   .header__controls[_ngcontent-%COMP%]{display:flex;gap:10px;align-items:center}.group-dialog[_ngcontent-%COMP%]   .header__control[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;color:#d27091}.group-dialog[_ngcontent-%COMP%]   .header__control[_ngcontent-%COMP%]:hover{background-color:#fffefe26}.group-dialog[_ngcontent-%COMP%]   .header__control[_ngcontent-%COMP%]:disabled{color:#fff}.group-dialog[_ngcontent-%COMP%]   .group-dialog__main[_ngcontent-%COMP%]{margin-top:20px;border:1px solid rgb(210,112,145);border-radius:8px;position:relative;min-height:400px}"]})}return t})();var wt=h(2572);let He=(()=>{class t{constructor(s,o,n){this.store=s,this.countdownService=o,this.usersService=n,this.isAllConversationsLoading$=this.store.pipe((0,r.Ys)(lt)),this.isConversationLoading$=this.store.pipe((0,r.Ys)(dt)),this.backendErrors$=this.store.pipe((0,r.Ys)(mt)),this.isUsersLoading$=this.store.pipe((0,r.Ys)(Je)),this.subscriptions=[]}loadMessagesSince(s,o){o.pipe((0,E.q)(1)).subscribe(n=>{this.store.dispatch(N({conversationID:s,time:n?.lastUpdated||0}))})}subscribeToConversationData(s,o){(0,wt.a)([this.isUsersLoading$,this.isAllConversationsLoading$]).subscribe(([n,i])=>{!n&&!i&&!this.usersService.isConversationJustCreated$.value&&this.loadMessagesSince(s,o)})}updateConversation(s,o){this.loadMessagesSince(s,o);const n=this.isConversationLoading$.subscribe(i=>{i||this.backendErrors$.subscribe(u=>{u||this.countdownService.handleCountdown("conversation"+s,60)})});this.subscriptions.push(n)}static#e=this.\u0275fac=function(o){return new(o||t)(e.LFG(r.yh),e.LFG(P),e.LFG(F))};static#t=this.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac})}return t})(),Ke=(()=>{class t{constructor(s,o,n,i,u,p){this.countdownService=s,this.route=o,this.store=n,this.conversationPageService=i,this.usersService=u,this.messagesService=p,this.isConversationLoading$=this.conversationPageService.isConversationLoading$,this.backendErrors$=this.conversationPageService.backendErrors$,this.converastionID=""}ngOnInit(){this.initConversationPageValues(),this.conversationPageService.subscribeToConversationData(this.converastionID,this.conversationData$)}initConversationPageValues(){this.converastionID=this.route.snapshot.paramMap.get("id"),this.conversationData$=this.store.pipe((0,r.Ys)((t=>(0,r.P1)(U,a=>a.users&&a.users.items&&a.users.items.find(s=>s.conversatonID===t)||null))(this.converastionID)))}ngOnDestroy(){this.conversationPageService.subscriptions.forEach(s=>s.unsubscribe())}static#e=this.\u0275fac=function(o){return new(o||t)(e.Y36(P),e.Y36(C.gz),e.Y36(r.yh),e.Y36(He),e.Y36(F),e.Y36(Y))};static#t=this.\u0275cmp=e.Xpm({type:t,selectors:[["app-conversation-page"]],decls:26,vars:21,consts:[[1,"group-dialog"],[1,"group-dialog__header"],[1,"content"],[1,"header__title"],["routerLink","/","title","Go to main page",1,"header__control"],[1,"header__controls"],[3,"disabled","buttonClick"],["title","Delete conversation","customClass","header__control header__control-delete",3,"disabled","buttonClick"],[3,"identifier"],[3,"isLoading"],[1,"group-dialog__main"],[3,"messages"],[3,"formGroup","isLoading$","sendMessage"]],template:function(o,n){if(1&o&&(e.TgZ(0,"section",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"a",4)(5,"mat-icon"),e._uU(6,"keyboard_arrow_left"),e.qZA()(),e.TgZ(7,"h2"),e._uU(8),e.ALo(9,"uppercase"),e.qZA()(),e.TgZ(10,"div",5)(11,"app-button",6),e.NdJ("buttonClick",function(){return n.conversationPageService.updateConversation(n.converastionID,n.conversationData$)}),e.ALo(12,"async"),e._uU(13),e.ALo(14,"uppercase"),e.qZA(),e.TgZ(15,"app-button",7),e.NdJ("buttonClick",function(){return n.usersService.onDeleteConversation(n.converastionID)}),e.ALo(16,"async"),e.TgZ(17,"mat-icon"),e._uU(18,"delete"),e.qZA()()()(),e._UZ(19,"app-countdown-message",8),e.qZA(),e._UZ(20,"app-loader",9),e.ALo(21,"async"),e.TgZ(22,"div",10),e._UZ(23,"app-messages-list",11),e.ALo(24,"async"),e.TgZ(25,"app-post-message-form",12),e.NdJ("sendMessage",function(){return n.messagesService.sendMessageForConversation(n.converastionID,n.conversationData$)}),e.qZA()()()),2&o){let i;e.xp6(8),e.Oqu(e.lcZ(9,9,"Conversation")),e.xp6(3),e.Q6J("disabled",!n.countdownService.isCountdownEnded("conversation"+n.converastionID)||!!e.lcZ(12,11,n.isConversationLoading$)),e.xp6(2),e.hij(" ",e.lcZ(14,13,"Update messages")," "),e.xp6(2),e.Q6J("disabled",!!e.lcZ(16,15,n.isConversationLoading$)),e.xp6(4),e.Q6J("identifier","conversation"+n.converastionID),e.xp6(1),e.Q6J("isLoading",e.lcZ(21,17,n.isConversationLoading$)),e.xp6(3),e.Q6J("messages",null==(i=e.lcZ(24,19,n.conversationData$))?null:i.messages),e.xp6(2),e.Q6J("formGroup",n.messagesService.createMessageForm)("isLoading$",n.isConversationLoading$)}},styles:[".group-dialog[_ngcontent-%COMP%]{padding:10px;max-width:800px;margin:0 auto}.group-dialog[_ngcontent-%COMP%]   .group-dialog__header[_ngcontent-%COMP%]{padding:10px;border-radius:8px;border:1px solid rgb(210,112,145);color:#d27091}.group-dialog[_ngcontent-%COMP%]   .group-dialog__header[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between}.group-dialog[_ngcontent-%COMP%]   .header__title[_ngcontent-%COMP%], .group-dialog[_ngcontent-%COMP%]   .header__controls[_ngcontent-%COMP%]{display:flex;gap:10px;align-items:center}.group-dialog[_ngcontent-%COMP%]   .header__control[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;color:#d27091}.group-dialog[_ngcontent-%COMP%]   .header__control[_ngcontent-%COMP%]:hover{background-color:#fffefe26}.group-dialog[_ngcontent-%COMP%]   .header__control[_ngcontent-%COMP%]:disabled{color:#fff}.group-dialog[_ngcontent-%COMP%]   .group-dialog__main[_ngcontent-%COMP%]{margin-top:20px;border:1px solid rgb(210,112,145);border-radius:8px;position:relative;min-height:400px}"]})}return t})();const $t=[{path:"",component:We,children:[{path:"",component:Dt,pathMatch:"full"},{path:Z.qr,component:at},{path:Z.Hj,component:Zt},{path:Z.kn,component:Ke,data:{created:!1}}]}];let Et=(()=>{class t{static#e=this.\u0275fac=function(o){return new(o||t)};static#t=this.\u0275mod=e.oAB({type:t});static#s=this.\u0275inj=e.cJS({imports:[C.Bz.forChild($t),C.Bz]})}return t})();var g=h(7483);const Tt=(0,r.Lq)({isLoading:!1,backendErrors:null,userData:null},(0,r.on)(W,ee,te,t=>({...t,isLoading:!0,backendErrors:null})),(0,r.on)(Oe,(t,a)=>({...t,isLoading:!1,backendErrors:null,userData:{uid:a.uid,email:a.email,createdAt:a.createdAt,name:a.name}})),(0,r.on)(Fe,(t,{error:a})=>({...t,isLoading:!1,backendErrors:a})),(0,r.on)(Ze,(t,a)=>{const s={name:a.name,uid:t.userData?.uid||"",email:t.userData?.email||"",createdAt:t.userData?.createdAt||""};return{...t,isLoading:!1,backendErrors:null,userData:s}}),(0,r.on)(we,(t,{error:a})=>({...t,isLoading:!1,backendErrors:a})),(0,r.on)($e,t=>({...t,isLoading:!1,backendErrors:null,userData:null})),(0,r.on)(Ee,(t,{error:a})=>({...t,isLoading:!1,backendErrors:a}))),Nt=(t,a)=>Tt(t,a);var v=h(4664),b=h(7398),S=h(6306),L=h(2096),Jt=h(8895);let Qe=(()=>{class t{constructor(s,o,n,i,u){this.http=s,this.localStorageService=o,this.router=n,this.auth=i,this.countdownService=u}loadUser(){return this.http.get(`${k.N.apiUrl}profile`)}updateUser(s){return this.http.put(`${k.N.apiUrl}profile`,{name:s})}logout(){return this.http.delete(`${k.N.apiUrl}logout`)}handleLogout(){this.localStorageService.clearStorage(),this.auth.isLoggedIn.next(!1),this.clearAllCookies(),this.countdownService.stopAllCountdowns(),this.router.navigateByUrl(`/${Z.UY}/${Z.Zd}`)}clearAllCookies(){const s=document.cookie.split(";");for(const o of s){const n=o.indexOf("="),i=n>-1?o.substring(0,n):o;document.cookie=`${i}=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/`}}static#e=this.\u0275fac=function(o){return new(o||t)(e.LFG(re.eN),e.LFG(Jt.n),e.LFG(C.F0),e.LFG(D.e),e.LFG(P))};static#t=this.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac})}return t})();var ue=h(3625);let Bt=(()=>{class t{constructor(s,o,n,i){this.actions$=s,this.userApiService=o,this.snackBar=n,this.datePipe=i,this.loadUser$=(0,g.GW)(()=>this.actions$.pipe((0,g.l4)(W),(0,v.w)(()=>this.userApiService.loadUser().pipe((0,b.U)(u=>(this.snackBar.addMessage(`${u.email.S} been succesfully loaded`,"snackbar-success"),Oe({uid:u.uid.S,email:u.email.S,name:u.name.S,createdAt:this.datePipe.transform(parseInt(u.createdAt.S),"yyyy-MM-dd HH:mm:ss")||"Date"}))),(0,S.K)(u=>{const p=u.error;return this.snackBar.addMessage(p?p.message:u.message,"snackbar-error"),(0,L.of)(Fe({error:u.error}))}))))),this.updateUserName$=(0,g.GW)(()=>this.actions$.pipe((0,g.l4)(ee),(0,v.w)(({name:u})=>this.userApiService.updateUser(u).pipe((0,b.U)(()=>(this.snackBar.addMessage("User name has been updated successfully","snackbar-success"),Ze({name:u}))),(0,S.K)(p=>{const c=p.error;return this.snackBar.addMessage(c?c.message:p.message,"snackbar-error"),(0,L.of)(we({error:p.error}))}))))),this.logout$=(0,g.GW)(()=>this.actions$.pipe((0,g.l4)(te),(0,v.w)(()=>this.userApiService.logout().pipe((0,b.U)(()=>(this.snackBar.addMessage("Logout successful","snackbar-success"),this.userApiService.handleLogout(),$e())),(0,S.K)(u=>{const p=u.error;return this.snackBar.addMessage(p?p.message:u.message,"snackbar-error"),(0,L.of)(Ee({error:u.error}))})))))}static#e=this.\u0275fac=function(o){return new(o||t)(e.LFG(g.eX),e.LFG(Qe),e.LFG(ue.c),e.LFG(_.uU))};static#t=this.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac})}return t})();var pe=h(6208),le=h(6889);let Yt=(()=>{class t{static#e=this.\u0275fac=function(o){return new(o||t)};static#t=this.\u0275mod=e.oAB({type:t});static#s=this.\u0275inj=e.cJS({providers:[_.uU,Qe,se],imports:[_.ez,f.UX,pe.m,le.q,r.Aw.forFeature(x.A.User,Nt),g.sQ.forFeature([Bt])]})}return t})();const Ht=(0,r.Lq)({isLoading:!1,backendErrors:null,groups:null,loadedGroupIds:null},(0,r.on)(J,q,V,B,w,B,w,t=>({...t,isLoading:!0,backendErrors:null})),(0,r.on)(Ue,(t,a)=>({...t,isLoading:!1,backendErrors:null,groups:a.groups})),(0,r.on)(ke,(t,a)=>{const s=(t.groups?.items||[]).map(o=>o.uid===a.groupID?{...o,messages:{count:a.groupData.count,items:[...o.messages?.items||[],...a.groupData.items]},lastUpdated:a.time}:o);return{...t,groups:{...t.groups,items:s},isLoading:!1,backendErrors:null}}),(0,r.on)(Ge,ye,xe,z,j,z,j,(t,a)=>({...t,isLoading:!1,backendErrors:a.error})),(0,r.on)(Me,(t,a)=>{const s=t.groups?{...t.groups,items:[{uid:a.groupID,name:a.name,createdAt:String((new Date).getTime()),createdBy:a.userId},...t.groups.items]}:null;return{...t,isLoading:!1,backendErrors:null,groups:s}}),(0,r.on)(De,(t,a)=>{if(t.groups){const s=t.groups.items.filter(i=>i.uid!==a.groupID),o=t?.loadedGroupIds?.filter(i=>i!==a.groupID)??null,n={...t.groups,items:s};return{...t,isLoading:!1,backendErrors:null,groups:n,loadedGroupIds:o}}return t})),Kt=(t,a)=>Ht(t,a);let Qt=(()=>{class t{constructor(s,o,n,i,u,p){this.actions$=s,this.groupsApi=o,this.snackBar=n,this.router=i,this.store=u,this.groupsservice=p,this.loadGroups$=(0,g.GW)(()=>this.actions$.pipe((0,g.l4)(J),(0,v.w)(()=>this.groupsApi.loadGroups().pipe((0,b.U)(c=>{this.snackBar.addMessage("Groups have been succesfully loaded","snackbar-success");const d=c.Items.map(l=>({createdAt:l.createdAt.S,uid:l.id.S,name:l.name.S,createdBy:l.createdBy.S}));return Ue({groups:{count:c.Count,items:d}})}),(0,S.K)(c=>{const d=c.error;return this.snackBar.addMessage(d?d.message:c.message,"snackbar-error"),(0,L.of)(Ge({error:c.error}))}))))),this.loadGroupDialogSince$=(0,g.GW)(()=>this.actions$.pipe((0,g.l4)(w),(0,v.w)(({groupID:c,time:d})=>this.groupsApi.loadAllMesages(c,d).pipe((0,b.U)(l=>{this.snackBar.addMessage("Last messages have been succesfully loaded","snackbar-success");const m=l.Items.map(A=>({authorID:A.authorID.S,message:A.message.S,createdAt:A.createdAt.S}));return ke({groupID:c,time:(new Date).getTime(),groupData:{count:l.Count,items:m}})}),(0,S.K)(l=>{const m=l.error;return this.snackBar.addMessage(m?m.message:l.message,"snackbar-error"),(0,L.of)(j({error:l.error}))}))))),this.postNewMessage$=(0,g.GW)(()=>this.actions$.pipe((0,g.l4)(B),(0,v.w)(({groupID:c,message:d,time:l})=>this.groupsApi.postNewMessage(c,d).pipe((0,b.U)(()=>(this.snackBar.addMessage("Message was sent successfully","snackbar-success"),this.store.dispatch(w({groupID:c,time:l})),Ve())),(0,S.K)(m=>{const A=m.error;return this.snackBar.addMessage(A?A.message:m.message,"snackbar-error"),(0,L.of)(z({error:m.error}))}))))),this.createGroup$=(0,g.GW)(()=>this.actions$.pipe((0,g.l4)(q),(0,v.w)(({name:c,userId:d})=>this.groupsApi.createGroup(c).pipe((0,b.U)(l=>(this.snackBar.addMessage("Group have been succesfully created","snackbar-success"),this.groupsApi.isCreateGroupModalClosed.next(!0),this.groupsservice.isGroupJustCreated$.next(!0),Me({name:c,groupID:l.groupID,userId:d}))),(0,S.K)(l=>{this.groupsApi.isCreateGroupModalClosed.next(!1);const m=l.error;return this.snackBar.addMessage(m?m.message:l.message,"snackbar-error"),(0,L.of)(ye({error:l.error}))}))))),this.deleteGroup$=(0,g.GW)(()=>this.actions$.pipe((0,g.l4)(V),(0,v.w)(({groupID:c,redirect:d})=>this.groupsApi.deleteGroup(c).pipe((0,b.U)(()=>(this.snackBar.addMessage("Group have been succesfully deleted","snackbar-success"),d&&this.router.navigate(["/"]),De({groupID:c}))),(0,S.K)(l=>{const m=l.error;return this.snackBar.addMessage(m?m.message:l.message,"snackbar-error"),(0,L.of)(xe({error:l.error}))})))))}static#e=this.\u0275fac=function(o){return new(o||t)(e.LFG(g.eX),e.LFG(ie),e.LFG(ue.c),e.LFG(C.F0),e.LFG(r.yh),e.LFG(O))};static#t=this.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac})}return t})(),qe=(()=>{class t{constructor(s){this.http=s,this.USERS_API_URL=`${k.N.apiUrl}users`,this.CONVERSATIONS_API_URL=`${k.N.apiUrl}conversations/`,this.CONVERSATIONS_LIST_ENDPOINT="list",this.CONVERSATIONS_CREATE_ENDPOINT="create",this.CONVERSATIONS_READ_ENDPOINT="read",this.CONVERSATIONS_DELETE_ENDPOINT="delete",this.CONVERSATIONS_APPEND_ENDPOINT="append"}loadUsers(){return this.http.get(this.USERS_API_URL)}loadConversations(){return this.http.get(`${this.CONVERSATIONS_API_URL}${this.CONVERSATIONS_LIST_ENDPOINT}`)}createConversation(s){return this.http.post(`${this.CONVERSATIONS_API_URL}${this.CONVERSATIONS_CREATE_ENDPOINT}`,{companion:s})}loadConversation(s,o){return this.http.get(`${this.CONVERSATIONS_API_URL}${this.CONVERSATIONS_READ_ENDPOINT}?conversationID=${s}${o?`&since=${o}`:""}`)}deleteConversation(s){return this.http.delete(`${this.CONVERSATIONS_API_URL}${this.CONVERSATIONS_DELETE_ENDPOINT}?conversationID=${s}`)}postNewMessage(s,o){return this.http.post(`${this.CONVERSATIONS_API_URL}${this.CONVERSATIONS_APPEND_ENDPOINT}`,{conversationID:s,message:o})}static#e=this.\u0275fac=function(o){return new(o||t)(e.LFG(re.eN))};static#t=this.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac})}return t})(),qt=(()=>{class t{constructor(s,o,n,i,u){this.actions$=s,this.snackBar=o,this.usersApi=n,this.router=i,this.store=u,this.loadUsers$=(0,g.GW)(()=>this.actions$.pipe((0,g.l4)(T),(0,v.w)(({currentUserId:p})=>this.usersApi.loadUsers().pipe((0,b.U)(c=>{this.snackBar.addMessage("Users have been succesfully loaded","snackbar-success");const l=c.Items.map(m=>({name:m.name.S,uid:m.uid.S})).filter(m=>m.uid!==p);return this.store.dispatch(R()),ge({users:{count:c.Count,items:l},currentUserId:p})}),(0,S.K)(c=>{const d=c.error;return this.snackBar.addMessage(d?d.message:c.message,"snackbar-error"),(0,L.of)(he({error:c.error}))}))))),this.loadConversations$=(0,g.GW)(()=>this.actions$.pipe((0,g.l4)(R),(0,v.w)(()=>this.usersApi.loadConversations().pipe((0,b.U)(p=>(this.snackBar.addMessage("Conversations have been succesfully loaded","snackbar-success"),me({conversations:{count:p.Count,items:p.Items}}))),(0,S.K)(p=>{const c=p.error;return this.snackBar.addMessage(c?c.message:p.message,"snackbar-error"),(0,L.of)(_e({error:p.error}))}))))),this.createConversation$=(0,g.GW)(()=>this.actions$.pipe((0,g.l4)(H),(0,v.w)(({companion:p})=>this.usersApi.createConversation(p).pipe((0,b.U)(({conversationID:c})=>(this.snackBar.addMessage("Conversation have been succesfully created","snackbar-success"),this.router.navigate([`conversation/${c}`]),fe({companion:p,conversationId:c}))),(0,S.K)(c=>{const d=c.error;return this.snackBar.addMessage(d?d.message:c.message,"snackbar-error"),(0,L.of)(Ce({error:c.error}))}))))),this.loadConversationSince$=(0,g.GW)(()=>this.actions$.pipe((0,g.l4)(N),(0,v.w)(({conversationID:p,time:c})=>this.usersApi.loadConversation(p,c).pipe((0,b.U)(d=>{this.snackBar.addMessage("Last messages have been succesfully loaded","snackbar-success");const l=d.Items.map(m=>({authorID:m.authorID.S,message:m.message.S,createdAt:m.createdAt.S}));return ve({conversationID:p,time:(new Date).getTime(),conversationData:{count:d.Count,items:l}})}),(0,S.K)(d=>{const l=d.error;return this.snackBar.addMessage(l?l.message:d.message,"snackbar-error"),(0,L.of)(be({error:d.error}))}))))),this.deleteConversation$=(0,g.GW)(()=>this.actions$.pipe((0,g.l4)(K),(0,v.w)(({conversationID:p,redirect:c})=>this.usersApi.deleteConversation(p).pipe((0,b.U)(()=>(this.snackBar.addMessage("Conversation have been succesfully deleted","snackbar-success"),c&&this.router.navigate(["/"]),Se({conversationID:p}))),(0,S.K)(d=>{const l=d.error;return this.snackBar.addMessage(l?l.message:d.message,"snackbar-error"),(0,L.of)(Le({error:d.error}))}))))),this.postMessage$=(0,g.GW)(()=>this.actions$.pipe((0,g.l4)(Q),(0,v.w)(({conversationID:p,message:c,time:d})=>this.usersApi.postNewMessage(p,c).pipe((0,b.U)(()=>(this.snackBar.addMessage("Message was sent successfully","snackbar-success"),this.store.dispatch(N({conversationID:p,time:d})),Ae())),(0,S.K)(l=>{const m=l.error;return this.snackBar.addMessage(m?m.message:l.message,"snackbar-error"),(0,L.of)(Pe({error:l.error}))})))))}static#e=this.\u0275fac=function(o){return new(o||t)(e.LFG(g.eX),e.LFG(ue.c),e.LFG(qe),e.LFG(C.F0),e.LFG(r.yh))};static#t=this.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac})}return t})();const jt=(0,r.Lq)({isUsersLoading:!1,isAllConversationsLoading:!1,isConversationLoading:!1,backendUsersErrors:null,backendConverstionsErrors:null,users:null,loadedConversatonsIds:null},(0,r.on)(T,t=>({...t,isUsersLoading:!0,backendUsersErrors:null})),(0,r.on)(ge,(t,a)=>({...t,isUsersLoading:!1,backendUsersErrors:null,users:a.users})),(0,r.on)(he,(t,a)=>({...t,isUsersLoading:!1,backendUsersErrors:a.error})),(0,r.on)(R,t=>({...t,isAllConversationsLoading:!0,backendUsersErrors:null})),(0,r.on)(H,N,K,Q,t=>({...t,isConversationLoading:!0,backendUsersErrors:null})),(0,r.on)(_e,(t,a)=>({...t,isAllConversationsLoading:!1,backendConverstionsErrors:a.error})),(0,r.on)(Ce,be,Le,Pe,(t,a)=>({...t,isConversationLoading:!1,backendConverstionsErrors:a.error})),(0,r.on)(me,(t,a)=>{const s=(t.users?.items||[]).map(o=>{const n=a.conversations.items.find(i=>o.uid===i.companionID.S);return n?{...o,conversatonID:n.id.S}:o});return{...t,isAllConversationsLoading:!1,backendUsersErrors:null,backendConverstionsErrors:null,users:{items:s||[],count:t.users?.count||"0"}}}),(0,r.on)(fe,(t,{companion:a,conversationId:s})=>{const o=(t.users?.items||[]).map(n=>n.uid===a?{...n,conversatonID:s}:n);return{...t,isConversationLoading:!1,backendUsersErrors:null,backendConverstionsErrors:null,users:{items:o||[],count:t.users?.count||"0"}}}),(0,r.on)(ve,(t,a)=>{const s=t?.loadedConversatonsIds?[...t.loadedConversatonsIds,a.conversationID]:[a.conversationID],o=(t.users?.items||[]).map(n=>n.conversatonID&&n.conversatonID===a.conversationID?{...n,messages:{count:n.messages?.count+a.conversationData.count,items:[...n.messages?.items||[],...a.conversationData.items]},lastUpdated:a.time}:n);return{...t,isConversationLoading:!1,backendUsersErrors:null,backendConverstionsErrors:null,users:{items:o,count:t.users?.count||"0"},loadedConversatonsIds:s}}),(0,r.on)(Se,(t,a)=>{const s=t?.loadedConversatonsIds?.filter(n=>n!==a.conversationID)??null,o=(t.users?.items||[]).map(n=>n.conversatonID&&n.conversatonID===a.conversationID?{...n,messages:null,conversatonID:null,lastUpdated:null}:n);return{...t,isConversationLoading:!1,users:{items:o,count:t.users?.count||"0"},loadedConversatonsIds:s}}),(0,r.on)(Ae,t=>({...t,isConversationLoading:!1}))),zt=(t,a)=>jt(t,a);let Xt=(()=>{class t{static#e=this.\u0275fac=function(o){return new(o||t)};static#t=this.\u0275mod=e.oAB({type:t});static#s=this.\u0275inj=e.cJS({providers:[qe,ie,Be,O,F,He,Y],imports:[le.q,f.UX,pe.m,C.Bz,r.Aw.forFeature(x.A.Groups,Kt),r.Aw.forFeature(x.A.Users,zt),g.sQ.forFeature([Qt,qt]),_.ez]})}return t})();e.B6R(Ke,function(){return[$.Hw,f.JL,f.sg,ce,ae,M.r,C.rH,Ye,Re]},function(){return[_.Ov,_.gd]});let Wt=(()=>{class t{static#e=this.\u0275fac=function(o){return new(o||t)};static#t=this.\u0275mod=e.oAB({type:t});static#s=this.\u0275inj=e.cJS({imports:[_.ez,Et,Xt,Yt,pe.m,le.q]})}return t})()}}]);
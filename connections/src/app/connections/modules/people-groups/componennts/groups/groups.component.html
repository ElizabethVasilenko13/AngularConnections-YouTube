<div class="content__header">
  <h2>GROUPS</h2>
  <div class="btns__container">
    <app-button
      [disabled]="
        !countdownService.isCountdownEnded('groups') ||
        (isGroupsLoading$ | async) ||
        (groupsData$ | async) === null
      "
      (buttonClick)="groupsService.updateGroupsList()"
    >
      {{ 'Update List' | uppercase }}
    </app-button>
    <app-button
      customClass="create__btn"
      title="Create group"
      [disabled]="(isGroupsLoading$ | async) || (groupsData$ | async) === null"
      (buttonClick)="groupsService.onCreateGroup(createForm)"
    >
      <mat-icon>add</mat-icon>
    </app-button>
  </div>
  <app-countdown-message [identifier]="'groups'"></app-countdown-message>
</div>
<app-loader [isLoading]="isGroupsLoading$ | async"></app-loader>
<div class="content__items">
  <div
    *ngFor="let group of (groupsData$ | async)?.items"
    class="group-item"
    [class.groupCurrent]="groupsService.isGroupCreatedByCurrentUser(group.createdBy.S)"
  >
    <a routerLink="/group/{{ group.id.S }}" class="group__link">
      <div class="group-property">{{ group.name.S }}</div>
    </a>
    <app-button
      customClass="delete__btn"
      title="Delete"
      *ngIf="groupsService.isGroupCreatedByCurrentUser(group.createdBy.S)"
      [disabled]="(isGroupsLoading$ | async) || (groupsData$ | async) === null"
      (buttonClick)="groupsService.onDeleteGroup($event, group.id.S)"
    >
      ✕
    </app-button>
  </div>
</div>
<ng-template #createForm>
  <div class="create-form">
    <form
      [formGroup]="groupsService.groupCreateForm"
      (ngSubmit)="groupsService.onCreateFormSubmit()"
    >
      <app-form-control
        label="{{ 'name:' | uppercase }}"
        controlName="name"
        [control]="groupsService.groupCreateForm.get('name')"
        [control]="groupsService.groupCreateForm.get('name')"
        type="text"
        [readonly]="false"
      ></app-form-control>
      <app-button
        type="submit"
        [disabled]="(isGroupsLoading$ | async) || groupsService.groupCreateForm.invalid"
      >
        {{ 'Create Group' | uppercase }}
      </app-button>
    </form>
    <app-button
      customClass="close-dialog__btn"
      title="Close"
      (buttonClick)="dialogService.onDialogClose()"
    >
      ✕
    </app-button>
  </div>
</ng-template>
